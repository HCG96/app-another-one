angular.module("app.services.FileSystemFactory",[]).factory("FileSystemFactory",["$q",function(e){var t=e.defer();return window.requestFileSystem||(window.requestFileSystem=window.webkitRequestFileSystem),requestFileSystem&&navigator.webkitPersistentStorage&&navigator.webkitPersistentStorage.requestQuota&&window.PERSISTENT?navigator.webkitPersistentStorage.requestQuota(524288e3,function(r){requestFileSystem(PERSISTENT,r,function(r){var i=r.root,o={};o.fileReader=function(t,r){var i=new FileReader,o=e.defer();if(r||(r="text"),i.onload=function(){var e=i.result;if("json"===r)try{e=JSON.parse(e)}catch(t){}o.resolve(e)},i.onerror=o.reject,"text"===r||"json"===r)i.readAsText(t);else{if("dataUrl"!==r)throw new Error("Method FileSystemFactory.fileReader don't support fileType \""+r+'".');i.readAsDataURL(t)}return o.promise},o.readFile=function(t,r,n){var a=e.defer();return"boolean"==typeof r&&(n=r,r=""),i.getFile(t,{create:!!n},function(e){e.file(function(e){"file"===r?a.resolve(e):o.fileReader(e,r).then(a.resolve,a.reject)})},a.reject),a.promise},o.writeFile=function(t,r,n){var a=e.defer();return n||(n="text/plain"),o.deleteFile(t)["finally"](function(){i.getFile(t,{create:!0},function(e){e.createWriter(function(e){e.onerror=a.reject,e.onwriteend=a.resolve,e.write(new Blob(r,{type:n}))})})}),a.promise},o.deleteFile=function(t){var r=e.defer();return i.getFile(t,{create:!1},function(e){e.remove(r.resolve,r.reject)},r.reject),r.promise},t.resolve(o)})}):t.reject(),t.promise}]);