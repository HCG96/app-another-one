define(["../6e867381f6333fc9c95b78691e5477b1","./99a5359b879e35acf49099f731f28716"],function(t){t.factory("FetchVolFactory",["$http","$q","FileSystemFactory",function(t,e,n){function r(t){return t||(t=new Date),(new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-a)/u+1}function o(t){function e(t){var e;t=t.trim(),e=t.split(/\s+/),a.date.year=Number(e[1]),a.date.month=l[e[0]]||0}function n(t){var e,n=t.trim().split("\n");1===n.length&&n.unshift(""),e=n[1],a.index.imgTitle=n[0],a.index.imgAuthor=e.slice(0,e.indexOf(" "))}function r(t){t=t.trim(),a.article.author=t.slice(t.indexOf("/")+1)}function o(t){a.article.content="<p>"+t.trim().replace(/(\r?\n)+/g,"</p><p>")+"</p>"}function i(t){a.qa.answer="<p>"+t.trim().replace(/(\r?\n)+/g,"</p><p>")+"</p>"}var c={textContent:""},a={id:0,date:{year:0,month:0,day:Number((t.querySelector(".dom")||c).textContent.trim())},index:{imgUrl:(t.querySelector(".one-imagen img")||{src:""}).src,text:(t.querySelector(".one-cita")||c).textContent.trim(),imgTitle:"",imgAuthor:""},article:{summary:(t.querySelector(".comilla-cerrar")||c).textContent.trim(),title:(t.querySelector(".articulo-titulo")||c).textContent.trim(),author:"",content:""},qa:{q_title:(t.querySelector(".cuestion-q-icono+h4")||c).textContent.trim(),question:(t.querySelector(".cuestion-contenido")||c).textContent.trim(),a_title:(t.querySelector(".cuestion-a-icono+h4")||c).textContent.trim(),answer:""},dx:{imgUrl:(t.querySelector(".cosas-imagen img")||{src:""}).src,title:(t.querySelector(".cosas-titulo")||c).textContent.trim(),summary:(t.querySelector(".cosas-contenido")||c).textContent.trim()}};return n((t.querySelector(".one-imagen-leyenda")||c).textContent),r((t.querySelector(".articulo-autor")||{textContent:""}).textContent),o(t.querySelector(".articulo-contenido").textContent),i(((t.querySelectorAll(".cuestion-contenido")||[])[1]||c).textContent),e((t.querySelector(".may")||c).textContent),a}var i=0!==document.URL.indexOf("http"),c={domain:i?"http://wufazhuce.com":"https://dn-another-one.qbox.me",getVolDataFromHttp:function(r){var i=e.defer();return t.get(c.domain+"/one/vol."+r,{responseType:"document"}).then(function(t){var e,c=t.data;return c.title.indexOf("一个")>0?(e=o(c),e.id=Number(r),i.resolve(e),n.then(function(t){t.writeFile("vol"+r+".txt",[JSON.stringify(e)])}),void 0):i.reject("获取文章内容时出错，请检查你的网络设置")},function(t){return i.reject(404===t.status?"没有当期内容":"获取文章内容时出错，请检查你的网络设置")}),i.promise},getVolData:function(t){var r=e.defer();return n.then(function(e){e.readFile("vol"+t+".txt","json").then(r.resolve,function(){c.getVolDataFromHttp(t).then(r.resolve,r.reject)})},function(){c.getVolDataFromHttp(t).then(r.resolve,r.reject)}),r.promise}};c.getLastVolId=i?function(){var n=e.defer();return t.get(c.domain+"/one?"+Math.random(),{responseType:"document"}).then(function(t){var e=t.data.querySelector("#main-container .corriente .one-titulo a").textContent.trim();n.resolve(Number(e.match(/vol\.(\d+)$/i)[1]))},n.reject),n.promise}:function(){var t=e.defer();return t.resolve(r()),t.promise};var a=13496256e5,u=864e5,l={Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12};return c}])});